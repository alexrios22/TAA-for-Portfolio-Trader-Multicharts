////////////////////////////////////////////////
// SIGNAL: VAA_Signal_Base
// Seoal base aplicada a cada sombolo del portfolio
// Calcula momentum y lo envoa al PMM Signal
////////////////////////////////////////////////

Inputs:
    MomentumStyle(0),           // 0=13612W, 1=13612, 2=SMA12, 3=RET12
    IsStockSymbol(True),        // True=Stock, False=Bond
    BasedOnData(1);             // Data stream para colculo

Vars:
    momentum(0),
    currentPrice(0),
    price1m(0),
    price3m(0),
    price6m(0),
    price12m(0),
    sma13Months(0),
    barN(0),
    prevBarN(0);

// Restricciones
once if BarStatus(BasedOnData) < 0 then
    raiseruntimeerror("VAA Signal Base needs datastream " + NumToStr(BasedOnData, 0));

once if 1 <> getappinfo(aiisportfoliomode) then
    raiseruntimeerror("VAA Signal Base can be applied for MCPortfolio application only.");

// Detectar nueva barra mensual
barN = BarNumber of data(BasedOnData);

If barN > prevBarN then begin
    // Obtener precios historicos (usar data(BasedOnData) si es necesario)
    currentPrice = Close of data(BasedOnData);
    
    // Precios historicos (ajustar segon tu periodicidad)
    If CurrentBar >= 1 then
        price1m = Close[1] of data(BasedOnData)
    else
        price1m = 0;
    
    If CurrentBar >= 3 then
        price3m = Close[3] of data(BasedOnData)
    else
        price3m = 0;
    
    If CurrentBar >= 6 then
        price6m = Close[6] of data(BasedOnData)
    else
        price6m = 0;
    
    If CurrentBar >= 12 then
        price12m = Close[12] of data(BasedOnData)
    else
        price12m = 0;
    
    // Calcular SMA de 13 meses
    sma13Months = Average(Close of data(BasedOnData), 13);
    
    // Calcular momentum
    momentum = VAA_CalculateMomentum(
        MomentumStyle,
        currentPrice,
        price1m,
        price3m,
        price6m,
        price12m,
        sma13Months
    );
    
    // Enviar al PMM Signal
    pmm_set_my_named_num("Momentum", momentum);
    
    If IsStockSymbol then
        pmm_set_my_named_num("AssetType", 1)  // 1 = Stock
    else
        pmm_set_my_named_num("AssetType", 0); // 0 = Bond
    
    prevBarN = barN;
end;

// Generar ordenes dummy (seron manejadas por PMM)

buy this bar at close;
sellshort this bar at close;
